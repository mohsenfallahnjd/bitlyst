---
title: "queueMicrotask Explained: The Smallest Async Queue in JavaScript"
summary: "What queueMicrotask does, how it differs from Promise.then, and how microtasks really work under the hood."
publishedTime: "2025-10-31"
tags: ["javascript", "event loop", "microtask", "async"]
---

# queueMicrotask Explained

`queueMicrotask` is a low-level JavaScript API that lets you schedule a function to run in the **microtask queue**.

It runs:
- **After the current synchronous code**
- **Before any macrotasks** (`setTimeout`, `setInterval`, `requestAnimationFrame`)
- **Before rendering**

---

## ðŸ§  What Is a Microtask?

JavaScript has two main async queues:

| Queue | Examples |
|-----|---------|
| Microtask | `queueMicrotask`, `Promise.then`, `await` |
| Macrotask | `setTimeout`, events |

JavaScript always drains the microtask queue **fully** before moving on.

---

## âš™ï¸ Basic Usage

```js
queueMicrotask(() => {
  console.log("microtask");
});

console.log("sync");
```

Output:
```
sync
microtask
```

---

## ðŸ” queueMicrotask vs Promise.then

| Feature | queueMicrotask | Promise.then |
|-------|----------------|--------------|
| Creates Promise | âŒ | âœ… |
| Intent clarity | âœ… | âš ï¸ |
| Error handling | Global | Promise-based |

---

## âš ï¸ Error Behavior

```js
queueMicrotask(() => {
  throw new Error("boom");
});
```

This becomes a global error, not a rejected Promise.

---

## ðŸ” Execution Order Example

```js
console.log("start");

setTimeout(() => console.log("timeout"), 0);
queueMicrotask(() => console.log("microtask"));
Promise.resolve().then(() => console.log("promise"));

console.log("end");
```

Output:
```
start
end
microtask
promise
timeout
```

---

## ðŸš¨ Microtask Starvation

```js
function loop() {
  queueMicrotask(loop);
}
loop();
```

This freezes the page because microtasks never finish.

---

## ðŸ§© When to Use

âœ… Precise scheduling  
âœ… Libraries / frameworks  
âŒ Delays or animations  

---

## âœ… Summary

| Concept | Meaning |
|------|--------|
| queueMicrotask | Schedules microtask |
| Priority | Higher than timers |
| Use carefully | Yes |

---

## âœ¨ Final Takeaway

> `queueMicrotask` is powerful but sharp â€” use it only when you need microtask precision.
